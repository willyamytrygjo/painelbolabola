return function(plr, RunService, UserInputService, SendNotify, CreateTouchButton, key, posX, posY)
    local Camera = workspace.CurrentCamera
    local Mouse = plr:GetMouse()

    local settings = {
        Aimbot = true,
        Aiming = false,
        TeamCheck = false,
        Aimbot_AimPart = "Head",
        Aimbot_FOV_Radius = 800,
        Aimbot_Draw_FOV = true
    }

    local fovcircle = Drawing.new("Circle")
    fovcircle.Visible = settings.Aimbot_Draw_FOV
    fovcircle.Radius = settings.Aimbot_FOV_Radius
    fovcircle.Thickness = 1
    fovcircle.Color = Color3.fromRGB(255, 0, 0)
    fovcircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

    local function IsEnemy(player)
        if not settings.TeamCheck then return true end
        if player.Team ~= nil and plr.Team ~= nil then
            return player.Team ~= plr.Team
        end
        return true
    end

    local function GetClosestTarget()
        local closest_target = nil
        local shortest_mouse_dist = settings.Aimbot_FOV_Radius

        for _, player in pairs(game:GetService("Players"):GetPlayers()) do
            if player ~= plr and player.Character and IsEnemy(player) then
                local char = player.Character
                local targetPart = char:FindFirstChild(settings.Aimbot_AimPart) or char:FindFirstChild("HumanoidRootPart") or char.PrimaryPart
                local hum = char:FindFirstChildOfClass("Humanoid")

                if targetPart and (not hum or hum.Health > 0) then
                    local screenPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
                    if onScreen then
                        local mouseDist = (Vector2.new(Mouse.X, Mouse.Y) - Vector2.new(screenPos.X, screenPos.Y)).Magnitude
                        if mouseDist < shortest_mouse_dist then
                            shortest_mouse_dist = mouseDist
                            closest_target = targetPart
                        end
                    end
                end
            end
        end
        return closest_target
    end

    UserInputService.InputBegan:Connect(function(input, gamep)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.MouseButton2 or input.UserInputType == Enum.UserInputType.Touch then
            settings.Aiming = true
        end
        
        if not gamep then
            if input.KeyCode == Enum.KeyCode[key] then
                settings.Aimbot = not settings.Aimbot
                SendNotify("Aimbot", settings.Aimbot and "LIGADO" or "DESLIGADO", 2)
            elseif input.KeyCode == Enum.KeyCode.N then
                settings.TeamCheck = not settings.TeamCheck
                SendNotify("Team Check", "Status: " .. (settings.TeamCheck and "ATIVADO" or "DESATIVADO"), 3)
            end
        end
    end)

    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.MouseButton2 or input.UserInputType == Enum.UserInputType.Touch then
            settings.Aiming = false
        end
    end)

    RunService.RenderStepped:Connect(function()
        fovcircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
        fovcircle.Visible = settings.Aimbot and settings.Aimbot_Draw_FOV

        if settings.Aimbot and settings.Aiming then
            local target = GetClosestTarget()
            if target then
                Camera.CFrame = CFrame.new(Camera.CFrame.Position, target.Position)
            end
        end
    end)

    SendNotify("Aimbot", "Iniciado! Team Checker [N] estÃ¡ DESATIVADO", 6)
    
    if CreateTouchButton then
        CreateTouchButton(function() 
            settings.Aimbot = not settings.Aimbot 
            SendNotify("Aimbot", settings.Aimbot and "LIGADO" or "DESLIGADO", 2)
        end, key, posX, posY)
    end
end
