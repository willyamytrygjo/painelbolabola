return function(plr, RunService, UserInputService, SendNotify, CreateTouchButton, key, posX, posY)
    local Camera = workspace.CurrentCamera
    local Mouse = plr:GetMouse()

    local settings = {
        Aimbot = true,
        Aiming = false,
        Aimbot_AimPart = "Head",
        Aimbot_Draw_FOV = true,
        Aimbot_FOV_Radius = 200, 
        Aimbot_FOV_Color = Color3.fromRGB(0, 255, 150),
        Smoothing = 1, 
        WallCheck = false
    }


    local fovcircle = Drawing.new("Circle")
    fovcircle.Visible = settings.Aimbot_Draw_FOV
    fovcircle.Radius = settings.Aimbot_FOV_Radius
    fovcircle.Color = settings.Aimbot_FOV_Color
    fovcircle.Thickness = 1
    fovcircle.Filled = false
    fovcircle.Transparency = 0.8
    fovcircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

   
    local function IsVisible(targetPart)
        if not settings.WallCheck then return true end
        local ray = Ray.new(Camera.CFrame.Position, (targetPart.Position - Camera.CFrame.Position).Unit * 500)
        local hit, pos = workspace:FindPartOnRayWithIgnoreList(ray, {plr.Character, targetPart.Parent})
        return hit == nil
    end

    local function IsEnemy(player)
        if player == plr or not player.Character then return false end

        if player.Team ~= nil and plr.Team ~= nil then
            return player.Team ~= plr.Team
        end
        return true
    end

    local function GetClosestTarget()
        local closest_target = nil
        local shortest_mouse_dist = settings.Aimbot_FOV_Radius

        for _, player in pairs(game:GetService("Players"):GetPlayers()) do
            if IsEnemy(player) then
                local char = player.Character
                local humanoid = char:FindFirstChild("Humanoid")
                local targetPart = char:FindFirstChild(settings.Aimbot_AimPart)

                if humanoid and humanoid.Health > 0 and targetPart then
                    local screenPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
                    
                    if onScreen and IsVisible(targetPart) then
                        local mouseDist = (Vector2.new(Mouse.X, Mouse.Y) - Vector2.new(screenPos.X, screenPos.Y)).Magnitude
                        
                        if mouseDist < shortest_mouse_dist then
                            shortest_mouse_dist = mouseDist
                            closest_target = targetPart
                        end
                    end
                end
            end
        end
        return closest_target
    end

    local function ToggleAimbot()
        settings.Aimbot = not settings.Aimbot
        fovcircle.Visible = settings.Aimbot and settings.Aimbot_Draw_FOV
        SendNotify("Aimbot", "Status: " .. (settings.Aimbot and "Ativado" or "Desativado"), 2)
    end

  
    UserInputService.InputBegan:Connect(function(input, gamep)
        if not gamep and input.KeyCode == Enum.KeyCode[key] then
            ToggleAimbot()
        end
    end)


    UserInputService.InputBegan:Connect(function(input, gamep)
        if not gamep then
            if input.UserInputType == Enum.UserInputType.MouseButton2 or input.UserInputType == Enum.UserInputType.Touch then
                settings.Aiming = true
            end
        end
    end)

    UserInputService.InputEnded:Connect(function(input, gamep)
        if input.UserInputType == Enum.UserInputType.MouseButton2 or input.UserInputType == Enum.UserInputType.Touch then
            settings.Aiming = false
        end
    end)


    RunService.RenderStepped:Connect(function()

        fovcircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

        if settings.Aimbot and settings.Aiming then
            local target = GetClosestTarget()
            if target then

                local targetCFrame = CFrame.new(Camera.CFrame.Position, target.Position)
                Camera.CFrame = Camera.CFrame:Lerp(targetCFrame, settings.Smoothing)
            end
        end
    end)

    SendNotify("Aimbot", "Carregado! Tecla: " .. key, 5)
    CreateTouchButton(ToggleAimbot, key, posX, posY)
end
